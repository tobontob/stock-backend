# 한국어 금융 뉴스 분석 시스템

AI 기반 한국어 금융 뉴스 감정분석 및 종목예측 시스템입니다.

## 🚀 주요 기능

### 1단계: 기본 분석 기능
- ✅ **감정분석**: KR-FinBERT + 경량 모델 앙상블
- ✅ **종목추출**: 문맥 기반 종목 추출 알고리즘
- ✅ **키워드매칭**: 고도화된 금융 키워드 매칭
- ✅ **설명형분석**: 템플릿 기반 분석근거 생성

### 2단계: 크롤링 및 전처리 개선
- ✅ **기사크롤링**: 언론사별 CSS 선택자 기반 크롤링
- ✅ **전처리강화**: 광고/저작권/기자명 필터링
- ✅ **품질개선**: 특수문자 및 중복 문장 제거
- ✅ **Fallback**: 다중 크롤링 전략

### 3단계: 서비스 품질 개선 및 코드 리팩토링 ⭐ **NEW**
- ✅ **코드리팩토링**: 클래스 기반 구조로 개선
- ✅ **로깅시스템**: 체계적인 로깅 및 에러 처리
- ✅ **API개선**: 분석 품질 지표 및 다중 관점 분석
- ✅ **성능모니터링**: 실시간 성능 및 품질 지표 추적
- ✅ **테스트시스템**: 종합 테스트 케이스 추가

## 📊 분석 품질 지표

### 감정분석 정확도
- **KR-FinBERT**: 금융 도메인 특화 모델
- **KoMiniLM**: 경량 모델로 빠른 처리
- **앙상블**: 두 모델의 장점 결합

### 종목추출 신뢰도
- **제목 우선**: 제목에서 발견 시 높은 신뢰도
- **문맥분석**: 금융 키워드와 함께 등장 시 우선순위
- **위치기반**: 제목 > 본문 앞부분 > 본문 중간 > 기타

### 키워드 매칭 다양성
- **금융키워드**: 주가, 실적, 투자 등
- **감정키워드**: 긍정/부정 감정 표현
- **영향도점수**: 키워드별 영향력 가중치

## 🏗️ 시스템 아키텍처

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   뉴스 크롤링   │───▶│   전처리 파이프  │───▶│   AI 분석 엔진   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  언론사별 CSS   │    │  필터링 & 정제  │    │  감정분석       │
│  선택자 크롤링  │    │  광고/저작권    │    │  종목추출       │
│  Fallback 전략  │    │  제거           │    │  키워드매칭     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                       │
                                                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  MongoDB 저장   │◀───│  분석결과 생성   │◀───│  설명형 분석근거 │
│  API 서비스     │    │  품질지표 추적   │    │  다중관점 분석   │
│  실시간 모니터링│    │  성능 리포트     │    │  템플릿 기반     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🛠️ 기술 스택

### Backend
- **FastAPI**: 고성능 API 프레임워크
- **MongoDB**: NoSQL 데이터베이스
- **PyTorch**: 딥러닝 프레임워크
- **Transformers**: Hugging Face 트랜스포머
- **KoNLPy**: 한국어 자연어 처리

### AI/ML
- **KR-FinBERT**: 금융 도메인 특화 BERT
- **KoMiniLM**: 경량 한국어 언어 모델
- **KNU 감성사전**: 한국어 감정 분석 사전
- **앙상블 모델**: 다중 모델 결합

### 크롤링
- **BeautifulSoup**: HTML 파싱
- **Requests**: HTTP 클라이언트
- **Selenium**: 동적 콘텐츠 처리

## 📈 성능 지표

### 처리 성능
- **평균 처리시간**: 3-5초/뉴스
- **배치 처리**: 10개씩 병렬 처리
- **성공률**: 95% 이상

### 분석 품질
- **감정분석 신뢰도**: 0.7 이상
- **종목추출 정확도**: 0.8 이상
- **키워드 다양성**: 평균 5개 이상

## 🚀 설치 및 실행

### 1. 환경 설정
```bash
# 가상환경 생성
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 의존성 설치
pip install -r requirements.txt
```

### 2. 환경변수 설정
```bash
# .env 파일 생성
MONGODB_URI=mongodb://localhost:27017/
FORCE_REANALYZE=false
```

### 3. 실행
```bash
# API 서버 실행
uvicorn app:app --host 0.0.0.0 --port 8000

# 뉴스 분석 실행
python news_analyzer/main.py

# 테스트 실행
python test_improved_system.py
```

## 📋 API 엔드포인트

### 기본 엔드포인트
- `GET /`: API 상태 확인
- `GET /health`: 헬스 체크

### 뉴스 분석
- `GET /analyzed_news`: 분석된 뉴스 목록
- `GET /news/{news_id}`: 특정 뉴스 상세 정보

### 분석 품질
- `GET /analysis/quality`: 분석 품질 통계
- `GET /stocks/popular`: 인기 종목 조회
- `GET /sentiment/trend`: 감정 트렌드 조회

## 🔧 설정 옵션

### 분석 설정
```python
# main.py에서 설정 가능
STOCK_EXTRACTION_CONFIG = {
    "max_title_length": 200,
    "max_content_length": 500,
    "min_confidence": 0.6,
    "blacklist": ["삼성전자", "LG전자"],  # 너무 일반적인 종목
    "whitelist": {  # 업종별 중요 종목
        "반도체": ["SK하이닉스", "삼성전자"],
        "바이오": ["셀트리온", "삼성바이오로직스"]
    }
}
```

### 성능 모니터링
```python
# performance_monitor.py에서 설정 가능
quality_thresholds = {
    "sentiment_confidence": 0.6,
    "stock_confidence": 0.7,
    "keyword_diversity": 3,
    "processing_time": 5.0
}
```

## 📊 모니터링 및 로깅

### 로그 파일
- `news_analysis.log`: 분석 과정 로그
- `analysis_metrics_YYYYMMDD_HHMMSS.json`: 성능 지표 내보내기

### 성능 리포트
```
📊 성능 리포트
============================================================
처리된 뉴스: 50개
실패한 뉴스: 2개
성공률: 96.2%
평균 처리시간: 3.45초
총 소요시간: 172.50초
============================================================
```

## 🧪 테스트

### 종합 테스트 실행
```bash
python test_improved_system.py
```

### 테스트 항목
- ✅ NewsAnalyzer 클래스 초기화
- ✅ 감정분석 정확도
- ✅ 종목추출 신뢰도
- ✅ 설명형 분석근거 생성
- ✅ 기사 크롤링 성능
- ✅ 전체 분석 파이프라인

## 🔄 업데이트 히스토리

### 3단계 (현재)
- **코드 리팩토링**: 클래스 기반 구조로 개선
- **로깅 시스템**: 체계적인 에러 처리 및 모니터링
- **API 개선**: 분석 품질 지표 및 다중 관점 분석
- **성능 모니터링**: 실시간 성능 및 품질 지표 추적
- **테스트 시스템**: 종합 테스트 케이스 추가

### 2단계
- **크롤링 개선**: 언론사별 CSS 선택자 기반 크롤링
- **전처리 강화**: 광고/저작권/기자명 필터링
- **품질 개선**: 특수문자 및 중복 문장 제거
- **Fallback 전략**: 다중 크롤링 전략

### 1단계
- **감정분석**: KR-FinBERT + 경량 모델 앙상블
- **종목추출**: 문맥 기반 종목 추출 알고리즘
- **키워드매칭**: 고도화된 금융 키워드 매칭
- **설명형분석**: 템플릿 기반 분석근거 생성

## 📞 문의

프로젝트 관련 문의사항이 있으시면 이슈를 등록해 주세요.

---

**Railway Hobby 플랜에서 운영 중** - 리소스 한계로 경량 모델만 사용 가능 